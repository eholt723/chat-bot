<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Chat Bot</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0f1115; --card:#151822; --muted:#9aa3b2; --accent:#4b82ff; --border:#212638; --text:#e8eefc; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:800px;margin:24px auto;padding:16px}
    h1{font-size:20px;margin:0 0 12px}
    .chat{background:var(--card);border:1px solid var(--border);border-radius:16px;height:62vh;overflow:auto;padding:16px}
    .msg{max-width:80%;padding:10px 12px;border-radius:12px;margin:8px 0;line-height:1.4;white-space:pre-wrap}
    .me{margin-left:auto;background:var(--accent);color:#fff}
    .bot{background:#131622;border:1px solid var(--border)}
    .typing{display:flex;gap:6px;margin:8px 0}
    .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);opacity:.7;animation:b 1.2s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    @keyframes b {0%,80%,100%{transform:translateY(0)} 40%{transform:translateY(-4px)}}
    form{display:flex;gap:8px;margin-top:12px}
    input{flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0f1320;color:var(--text)}
    button{padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:var(--accent);color:#fff;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .bar{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:12px;margin-bottom:8px}
    code{background:#0f1320;padding:2px 6px;border-radius:6px;border:1px solid var(--border)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">Model: <code>Cohere</code> · History trimmed for speed</div>
    <div id="chat" class="chat"></div>
    <form id="f">
      <input id="t" placeholder="Say hi…" autocomplete="off"/>
      <button>Send</button>
    </form>
  </div>
<script>
const chat = document.getElementById('chat');
const form = document.getElementById('f');
const input = document.getElementById('t');

function add(role, text){
  const div = document.createElement('div');
  div.className = 'msg ' + (role === 'user' ? 'me' : 'bot');
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}
function typingBubble(){
  const row = document.createElement('div');
  row.className = 'typing';
  row.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
  chat.appendChild(row);
  chat.scrollTop = chat.scrollHeight;
  return row;
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const text = input.value.trim();
  if(!text) return;
  input.value = '';
  add('user', text);
  const bubble = typingBubble();
  form.querySelector('button').disabled = true;

  try{
    const res = await fetch('/chat', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({message: text})
    });
    const data = await res.json();
    bubble.remove();
    if(!data.ok) add('bot', 'Error: ' + (data.error || 'unknown'));
    else add('bot', data.reply || '(no reply)');
  }catch(err){
    bubble.remove();
    add('bot', 'Network error: ' + err.message);
  }finally{
    form.querySelector('button').disabled = false;
    input.focus();
  }
});
</script>
</body>
</html>
